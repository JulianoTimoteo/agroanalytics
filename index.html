<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroAnalytics - Dashboard Operacional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div id="loading-overlay" class="hidden">
        <div class="loading-content">
            <div class="loader-wrapper">
                <div class="loader"></div>
                <p>Carregando...</p>
            </div>
        </div>
    </div>
    
    <canvas id="particles-js"></canvas> 
    
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>AgroAnalytics</h1>
                <span class="beta-tag">MOAGEM</span>
            </div>
            
            <div class="header-controls">
                <div class="turno-display-container" id="shiftDisplay">
                    <div class="shift-progress-fill" id="shiftProgressFill"></div>
                    <div class="shift-info-content">
                        <i class="fas fa-clock selector-icon"></i>
                        <span id="shiftName">Calculando...</span>
                        <span id="shiftTimeRemaining" class="shift-timer">0%</span>
                    </div>
                </div>

                <button class="theme-toggle" onclick="window.agriculturalDashboard.toggleTheme()" aria-label="Alternar tema">
                    <i class="fas fa-sun" id="theme-icon"></i>
                </button>
            </div>
        </div>
    </header>

    <section class="upload-fixed-top" id="uploadSection">
    </section>

    <main class="dashboard-main">
        <div class="main-content-layout"> 
            
            <section class="analytics-container"> 
                
                <nav class="tabs-nav">
                    <button class="tab-button active" onclick="window.agriculturalDashboard.showTab('tab-gerenciar')">
                        <i class="fas fa-cogs"></i> Gerenciar
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-moagem')">
                        <i class="fas fa-industry"></i> Moagem
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-alertas')">
                        <i class="fas fa-exclamation-triangle"></i> Alertas
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-caminhao')">
                        <i class="fas fa-truck"></i> Caminhões
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-equipamento')">
                        <i class="fas fa-tractor"></i> Colheita
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-frentes')">
                        <i class="fas fa-map-marked-alt"></i> Frentes
                    </button>
                     <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-metas')">
                        <i class="fas fa-bullseye"></i> Metas
                    </button>
                    <button class="tab-button" onclick="window.agriculturalDashboard.showTab('tab-horaria')">
                        <i class="fas fa-clock"></i> Entrega HxH
                    </button>
                </nav>

                <div class="tabs-content">
                    
                    <div id="tab-gerenciar" class="tab-pane active">
                        <div class="analytics-row">
                            <div class="analytics-card glass-card half-width hover-zoom-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-upload"></i> Carregamento de Dados</h3>
                                </div>
                                
                                <div class="dropzone-card glass-card upload-highlight" id="dropzoneCard"> 
                                    <label for="fileInput" class="sr-only">Upload de Arquivo</label>
                                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" 
                                        multiple webkitdirectory directory hidden>
                                    
                                    <div class="dropzone-content">
                                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                        <p class="drop-text">Arraste e Solte seus arquivos ou pastas aqui</p>
                                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                            <i class="fas fa-file-import"></i> 
                                            Selecionar Arquivo
                                        </button>
                                    </div>
                                    <div class="file-info-compact" id="fileInfo">Aguardando arquivo...</div>
                                </div>

                                <div class="info-section upload-info-section"> 
                                    <h4>Instruções:</h4>
                                    <p>Arraste e solte <strong>múltiplos arquivos</strong> ou uma <strong>pasta inteira</strong>
                                        na área acima, ou utilize o botão 'Selecionar Arquivo'.</p>
                                    <p>Formatos aceitos: Excel (.xlsx, .xls) e CSV</p>
                                    <p class="upload-warning-text">
                                        Aguarde a mensagem de "Arquivos carregados" ou "Falha no carregamento"
                                        antes de interagir com as outras abas.
                                    </p>
                                </div>

                            </div>
                            <div class="analytics-card glass-card half-width hover-zoom-card">
                                <div class="card-header">
                                    <h3><i class="fas fa-clipboard-list"></i> Relatórios de Configuração</h3>
                                </div>
                                <div class="mini-list">
                                    <p>Status de Conexão: <span class="success-color-bold">ATIVO</span></p>
                                    <p>Última Configuração: <span class="primary-color">v1.2.3 - 2025-11-30</span></p>
                                    <p><button class="btn-action" onclick="alert('Baixando Log de Eventos.')">Baixar Log</button></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="analyticalContent"> 

                        <div id="tab-moagem" class="tab-pane">
                            <div class="kpi-fixed-top-moagem">
                                <div class="glass-card stat-card-mini" id="cardPeso">
                                    <div class="stat-icon"><i class="fas fa-weight-hanging"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="totalPesoLiquido">0.00 ton</span>
                                        <span class="stat-label">Toneladas</span>
                                        <div class="stat-sub-info">
                                            <span class="sub-stat green" title="Própria">
                                                <i class="fas fa-circle"></i> <span id="percPropria">0%</span>
                                            </span>
                                            <span class="sub-stat orange" title="Terceiros">
                                                <i class="fas fa-circle"></i> <span id="percTerceiros">0%</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="glass-card stat-card-mini" id="cardViagens">
                                    <div class="stat-icon"><i class="fas fa-route"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="totalViagens">0</span>
                                        <span class="stat-label">Viagens Totais</span>
                                        <div class="stat-sub-info">
                                            <span class="sub-stat green" title="Própria">
                                                <span id="viagensProprias">0</span> Pró
                                            </span>
                                            <span class="separator">|</span>
                                            <span class="sub-stat orange" title="Terceiros">
                                                <span id="viagensTerceiros">0</span> Terc
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="glass-card stat-card-mini analysis-card" id="statAnalise">
                                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="taxaAnalise">0%</span>
                                        <span class="stat-label">Analisadas</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analytics-row fleet-status-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card" id="cardStatusFrota">
                                    <div class="card-header">
                                        <h3><i class="fas fa-truck-moving"></i> Status da Frota</h3>
                                    </div>
                                    <div class="fleet-status-grid" id="fleetStatusCardsGrid">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="analytics-row">
                                <div class="analytics-card glass-card half-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-bar"></i> Acumulado & Progresso</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle info-icon"></i>
                                                <div class="tooltip-text">Acompanhamento do progresso da Moagem em relação à meta diária configurada.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="moagem-control-panel">
                                        
                                        <div class="acumulado-display">
                                            <div class="acumulado-header">
                                                <span class="acumulado-label">Acumulado do Dia</span>
                                                <span class="acumulado-value" id="moagemAcumulado">0 t</span>
                                            </div>
                                            <div class="progress-container">
                                                <div class="progress-bar" id="moagemProgressBar"></div>
                                            </div>
                                            <div class="progress-stats">
                                                <span id="moagemPerc">0%</span> da Meta (<span id="moagemTargetDisplay">25000 t</span>)
                                            </div>
                                        </div>

                                        <div class="meta-setting-rodape-moagem">
                                            <div class="meta-item-rodape">
                                                <label for="metaMoagemInput">Meta Moagem (t/h):</label>
                                                <input type="number" id="metaMoagemInput" value="25000" class="moagem-input-discreto" onchange="window.agriculturalDashboard.saveMeta(this.value, 'metaMoagem')">
                                            </div>
                                            <div class="meta-item-rodape">
                                                <label for="metaRotacaoInput">Meta Rotação (RPM):</label>
                                                <input type="number" id="metaRotacaoInput" value="1100" class="moagem-input-discreto" onchange="window.agriculturalDashboard.saveMeta(this.value, 'metaRotacao')">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="analytics-card glass-card half-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-line"></i> Projeção De Moagem</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Estima se a meta será atingida com base no ritmo atual.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="forecast-panel">
                                        <div class="forecast-main">
                                            <span class="forecast-label">Previsão 24h</span>
                                            
                                            <div class="forecast-value-group">
                                                <span class="forecast-value-big" id="moagemForecast">0 t</span>
                                                <span class="forecast-diff" id="forecastDifferenceContainer"></span> 
                                            </div>
                                            <span class="forecast-badge" id="moagemStatus">Calculando...</span>
                                            
                                            <div class="owner-distribution-container" id="ownerDistributionBarContainer">
                                            </div>
                                            
                                            <div class="ritmo-medio-info" id="ritmoAtualFormulaContainer">
                                                </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>

                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-bar"></i> Visão Horária Detalhada</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Visualização detalhada do ritmo de moagem (Real, Potencial e Rotação) de hora em hora.</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="carousel-container wide" id="hourlyCarouselContainer">
                                        <div class="carousel-slide active">
                                            <div class="chart-container-title primary-color">Moagem(t/h)</div>
                                            <div class="chart-container wide">
                                                <canvas id="realHourlyChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="carousel-slide">
                                            <div class="chart-container-title potencial-color">Potencial(t/h)</div>
                                            <div class="chart-container wide">
                                                <canvas id="potencialHourlyChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="carousel-slide">
                                            <div class="chart-container-title rotacao-color">Rotação(RPM)</div>
                                            <div class="chart-container wide">
                                                <canvas id="rotacaoHourlyChart"></canvas>
                                            </div>
                                        </div>
                                        
                                        <button class="carousel-nav prev-btn" onclick="window.agriculturalDashboard.navigateCarousel(-1)" aria-label="Gráfico Anterior"><i class="fas fa-chevron-left"></i></button>
                                        <button class="carousel-nav next-btn" onclick="window.agriculturalDashboard.navigateCarousel(1)" aria-label="Próximo Gráfico"><i class="fas fa-chevron-right"></i></button>
                                        
                                        <div class="carousel-indicators" id="carouselIndicators">
                                            <span class="indicator active" onclick="window.agriculturalDashboard.showSlide(0)" aria-label="Ir para Gráfico 1"></span>
                                            <span class="indicator" onclick="window.agriculturalDashboard.showSlide(1)" aria-label="Ir para Gráfico 2"></span>
                                            <span class="indicator" onclick="window.agriculturalDashboard.showSlide(2)" aria-label="Ir para Gráfico 3"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-alertas" class="tab-pane">
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-check-circle"></i> Alertas de Conformidade</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Inconsistências encontradas nos dados (Pesos, Duplicidades).</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert-list" id="alertsContainer"></div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-caminhao" class="tab-pane">
                            
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-bar"></i> Entrega Horária (Própria vs Terceiros)</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Distribuição horária de peso entre frota própria e terceiros (Ciclo 06:00 - 05:59).
                                                Passe o mouse sobre as barras para ver os percentuais.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container wide">
                                        <canvas id="fleetHourlyChartInCaminhoes"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="analytics-row">
                                <div class="analytics-card glass-card half-width hover-zoom-card" style="min-height: 400px;">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-trophy"></i> Top 5 Caminhões</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Ranking das frotas com maior volume transportado.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="top-list-container side-by-side">
                                        <div class="top-list-section" id="topFrotasPropriasContainer">
                                            <h4>Próprias</h4>
                                            <div class="top-list" id="topFrotasProprias"></div>
                                        </div>
                                        <div class="top-list-section" id="topFrotasTerceirosContainer">
                                            <h4>Terceiros</h4>
                                            <div class="top-list" id="topFrotasTerceiros"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="analytics-card glass-card half-width hover-zoom-card" style="min-height: 400px;">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-pie"></i> Distribuição de Peso</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Proporção entre frota própria e terceirizada.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="fleetChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-equipamento" class="tab-pane">
                            
                            <div class="analytics-row">
                                <div class="analytics-card glass-card half-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-tractor"></i> Top 5 Colheita</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Equipamentos de colheita mais produtivos.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="top-list-container side-by-side">
                                        <div class="top-list-section">
                                            <h4>Próprias</h4>
                                            <div class="top-list" id="topEquipamentosProprios"></div>
                                        </div>
                                        <div class="top-list-section">
                                            <h4>Terceiros</h4>
                                            <div class="top-list" id="topEquipamentosTerceiros"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="analytics-card glass-card half-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-chart-pie"></i> Produtividade Colheita</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Participação de cada grupo de colhedoras no total.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="harvestChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-users"></i> Operadores e Transbordos</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Desempenho individual de operadores e transbordos.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="top-list-container side-by-side">
                                        <div class="top-list-section">
                                            <h4>Operadores de Colheita Própria</h4>
                                            <div class="top-list" id="topOperadoresColheitaPropria"></div>
                                        </div>
                                        <div class="top-list-section">
                                            <h4>Transbordos Terceiros</h4>
                                            <div class="top-list" id="topTransbordos"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-frentes" class="tab-pane">
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-map-pin"></i> Visão por Frente de Trabalho</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">
                                                    <strong>Regra de Ranking:</strong><br>
                                                    1º Maior Ton Total<br>
                                                    2º Menor Nº Viagens<br>
                                                    3º Melhor Ton/Viagem<br>
                                                    4º Maior Nº Análises
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fronts-grid" id="frontsGrid"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="tab-metas" class="tab-pane">
                            </div>

                        <div id="tab-horaria" class="tab-pane">
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-clock"></i> Viagens e Análise por Hora</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Fluxo de viagens e taxa de análise ao longo do dia.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container wide">
                                        <canvas id="timeChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="analytics-row">
                                <div class="analytics-card glass-card full-width hover-zoom-card">
                                    <div class="card-header">
                                        <div class="header-title-with-tooltip">
                                            <h3><i class="fas fa-calendar-alt"></i> Entrega de Peso por Frente</h3>
                                            <div class="tooltip-container">
                                                <i class="fas fa-info-circle icon"></i>
                                                <div class="tooltip-text">Volume horário entregue por cada frente.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container wide">
                                        <canvas id="frontHourlyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    </div>
            </section>
            
            </div> 
    </main>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loader"></div>
            <p>Carregando...</p>
        </div>
    </div>
    
    <footer class="dashboard-footer"></footer>


    <script src="intelligent-processor.js"></script>
    <script src="utils.js"></script>
    
    <script src="dataanalyzer.js"></script> 
    <script src="data-analyzer-kpis.js"></script>
    <script src="data-analyzer-rankings.js"></script>
    <script src="data-analyzer-time.js"></script>
    <script src="data-analyzer-metas.js"></script> 
    
    <script src="datavalidator.js"></script>

    <script src="visualizer-kpis.js"></script>
    <script src="visualizer-charts-base.js"></script>
    <script src="visualizer-charts-moagem.js"></script>
    <script src="visualizer-grid.js"></script>
    <script src="visualizer-metas.js"></script> 
    <script src="datavisualizer.js"></script>

    <script src="app.js"></script>
</body>
</html>